// ********** Equivalence predicates ***********
yume.global_add("eqv?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("eq?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("equal?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

// *********** Numerical operations ************
yume.global_add("number?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("complex?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("real?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("rational?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("integer?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("exact?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("inexact?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("=", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("<", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add(">", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("<=", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add(">=", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("+", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("*", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("-", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("/", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("quotient", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("remainder", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("modulo", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("numerator", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("denominator", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("floor", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("ceiling", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("truncate", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("round", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("exp", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("log", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("sin", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("cos", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("tan", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("asin", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("acos", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("atan", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("atan", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("sqrt", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("expt", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("make-rectangular", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("make-polar", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("real-part", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("imag-part", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("magnitude", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("angle", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("exact->inexact", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("inexact->exact", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

// ******** Numerical input and output *********
yume.global_add("number->string", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("number->string", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("string->number", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("string->number", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

// ************** Pairs and lists **************
yume.global_add("pair?", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	return {
		cps: cps,
		result: yume.is_pair(p) ? yume._boolean._true: yume._boolean._false
	};
},
yume._null_list, 1, false));

yume.global_add("cons", new yume._procedure(function(cps, scope) {
	// arguments syntax is already checked outside
	var frame = scope.car();
	var a = frame.car();
	var d = frame.cdr().car();
	return {
		cps: cps,
		result: yume.cons(a, d)
	};
},
yume._null_list, 2, false));

yume.global_add("car", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	if (!yume.is_pair(p)) {
		throw "runtime-error: " + p + " is not pair";
	}
	return {
		cps: cps,
		result: p.car()
	};
},
yume._null_list, 1, false));

yume.global_add("cdr", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	if (!yume.is_pair(p)) {
		throw "runtime-error: " + p + " is not pair";
	}
	return {
		cps: cps,
		result: p.cdr()
	};
},
yume._null_list, 1, false));

yume.global_add("set-car!", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	var v = frame.cdr().car();
	if (!yume.is_pair(p)) {
		throw "runtime-error: " + p + " is not pair";
	}
	return {
		cps: cps,
		result: p.set_car(v)
	};
},
yume._null_list, 2, false));

yume.global_add("set-cdr!", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	var v = frame.cdr().car();
	if (!yume.is_pair(p)) {
		throw "runtime-error: " + p + " is not pair";
	}
	return {
		cps: cps,
		result: p.set_cdr(v)
	};
},
yume._null_list, 2, false));

// ****************** Symbols ******************
yume.global_add("symbol?", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	return {
		cps: cps,
		result: yume.is_symbol(p) ? yume._boolean._true: yume._boolean._false
	};
},
yume._null_list, 1, false));

yume.global_add("symbol->string", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	if (!yume.is_symbol(p)) {
		throw "runtime-error: " + p + " is not symbol";
	}
	return {
		cps: cps,
		result: new yume._string(p.get_name())
	};
},
yume._null_list, 1, false));

yume.global_add("string->symbol", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	if (!yume.is_string(p)) {
		throw "runtime-error: " + p + " is not string";
	}
	return {
		cps: cps,
		result: new yume._symbol(p.get_value())
	};
},
yume._null_list, 1, false));

// **************** Characters *****************
// TODO: ...
// ****************** Strings ******************
yume.global_add("string?", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("make-string", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("string-length", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("string-ref", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("string-set!", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("string-append", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var h = frame.car();
	if (!yume.is_string(h)) {
		throw "runtime-error: " + h + " is not string";
	}
	var r = h.get_value();
	for (var t = frame.cdr();
	(!yume.is_null_list(t));
	t = t.cdr()) {
		if (!yume.is_pair(t)) {
			throw "runtime-error: " + frame + " is not propper list";
		}
		var s = t.car();
		if (!yume.is_string(s)) {
			throw "runtime-error: " + s + " is not string";
		}
		r += s.get_value();
	}
	return {
		cps: cps,
		result: new yume._string(r)
	};
},
yume._null_list, 1, true));

// ***************** Vectors *******************
// TODO:
// ************* Control features **************
yume.global_add("procedure? ", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("apply", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("call-with-current-continuation", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("values ", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("call-with-values", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("dynamic-wind", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

// ******************* Eval ********************
yume.global_add("eval", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

// ************* Input and output **************
// ****************** Ports ********************
yume.global_add("input-port?", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	return {
		cps: cps,
		result: yume.is_input(p) ? yume._boolean._true: yume._boolean._false
	};
},
yume._null_list, 1, false));

yume.global_add("output-port?", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	return {
		cps: cps,
		result: yume.is_output(p) ? yume._boolean._true: yume._boolean._false
	};
},
yume._null_list, 1, false));

yume.global_add("current-input-port", new yume._procedure(function(cps, scope) {
	return {
		cps: cps,
		result: new yume._input(yume.current_input_port())
	};
},
yume._null_list, 0, false));

yume.global_add("current-output-port", new yume._procedure(function(cps, scope) {
	return {
		cps: cps,
		result: new yume._output(yume.current_output_port())
	};
},
yume._null_list, 0, false));

yume.global_add("open-input-file", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("open-output-file", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("close-input-port", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	if (!yume.is_input(p)) {
		throw "runtime-error: " + s + " is not input port";
	}
	p.close();
	return {
		cps: cps,
		result: undefined
	};
},
yume._null_list, 1, false));

yume.global_add("close-output-port", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	if (!yume.is_output(p)) {
		throw "runtime-error: " + s + " is not output port";
	}
	p.close();
	return {
		cps: cps,
		result: undefined
	};
},
yume._null_list, 1, false));

// ******************* Input *******************
yume.global_add("read-char", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p;
	if (yume.is_pair(frame)) {
		p = frame.car();
		if (!yume.is_input(p)) {
			throw "runtime-error: " + p + " is not input port";
		}
		if (!yume.is_null_list(frame.cdr())) {
			throw "runtime-error: read-char " + frame + " extra arguments";
		}
	} else {
		p = yume.current_input_port();
	}
	var result = p.read();
	if (! (yume.is_char(result) || yume.is_eof(result))) {
		throw "internal-runtime-error: read-char return " + result;
	}
	return {
		cps: cps,
		result: result
	};
},
yume._null_list, 0, true));

yume.global_add("peek-char", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p;
	if (yume.is_pair(frame)) {
		p = frame.car();
		if (!yume.is_input(p)) {
			throw "runtime-error: " + p + " is not input port";
		}
		if (!yume.is_null_list(frame.cdr())) {
			throw "runtime-error: peek-char " + frame + " extra arguments";
		}
	} else {
		p = yume.current_input_port();
	}
	var result = p.peek();
	if (! (yume.is_char(result) || yume.is_eof(result))) {
		throw "internal-runtime-error: peek-char return " + result;
	}
	return {
		cps: cps,
		result: result
	};
},
yume._null_list, 0, true));

yume.global_add("eof-object?", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p = frame.car();
	return {
		cps: cps,
		result: yume.is_eof(p) ? yume._boolean._true: yume._boolean._false
	};
},
yume._null_list, 1, false));

yume.global_add("char-ready?", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var p;
	if (yume.is_pair(frame)) {
		p = frame.car();
		if (!yume.is_input(p)) {
			throw "runtime-error: " + p + " is not input port";
		}
		if (!yume.is_null_list(frame.cdr())) {
			throw "runtime-error: char-ready? " + frame + " extra arguments";
		}
	} else {
		p = yume.current_input_port();
	}
	var result = p.ready();
	if (! yume.is_boolean(result)) {
		throw "internal-runtime-error: char-ready? return " + result;
	}
	return {
		cps: cps,
		result: result
	};
},
yume._null_list, 0, true));

yume.global_add("write-char", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var c = frame.car();
	if (!yume.is_char(c)) {
		throw "runtime-error: " + c + " is not char";
	}
	var p;
	if (yume.is_pair(frame.cdr())) {
		p = frame.cdr().car();
		if (!yume.is_output(p)) {
			throw "runtime-error: " + p + " is not output port";
		}
		if (!yume.is_null_list(frame.cdr().cdr())) {
			throw "runtime-error: write-char " + frame + " extra arguments";
		}
	} else {
		p = yume.current_output_port();
	}
	return {
		cps: cps,
		result: p.write(c.get_value())
	};
},
yume._null_list, 1, true));

yume.global_add("write-string", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var s = frame.car();
	if (!yume.is_string(s)) {
		throw "runtime-error: " + s + " is not string";
	}
	var p;
	if (yume.is_pair(frame.cdr())) {
		p = frame.cdr().car();
		if (!yume.is_output(p)) {
			throw "runtime-error: " + p + " is not output port";
		}
		if (!yume.is_null_list(frame.cdr().cdr())) {
			throw "runtime-error: write-string" + frame + " extra arguments";
		}
	} else {
		p = yume.current_output_port();
	}
	return {
		cps: cps,
		result: p.write(s.get_value())
	};
},
yume._null_list, 1, true));

// ************* System interface **************
yume.global_add("load", new yume._procedure(function(cps, scope) {
	var frame = scope.car();
	var s = frame.car();
	if (!yume.is_string(s)) {
		throw "runtime-error: " + s + " is not string";
	}
	return yume.load(cps, s.get_value());
},
yume._null_list, 1, false));

yume.global_add("transcript-on", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

yume.global_add("transcript-off", new yume._procedure(function(cps, scope) {
	throw "not-implement";
	/*return { cps: cps, result: "not-implement" };*/
},
yume._null_list, 0, true));

